<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nexora Chat — Email/Password</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
  background: linear-gradient(135deg, #0f172a, #1e293b);
  color: white;
  display: flex;
  flex-direction: column;
  height: 100vh;
}
header {
  background: rgba(255,255,255,0.05);
  padding: 12px;
  text-align: center;
  font-weight: bold;
  font-size: 18px;
  backdrop-filter: blur(6px);
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
#auth-section, #chat-section {
  padding: 14px;
}
input, button {
  padding: 10px;
  margin: 6px 0;
  width: 100%;
  border-radius: 8px;
  border: none;
  font-size: 15px;
}
input {
  background: rgba(255,255,255,0.08);
  color: white;
}
button {
  background: #3b82f6;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
.messages {
  flex: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding-bottom: 60px;
}
.msg {
  max-width: 80%;
  padding: 10px;
  border-radius: 12px;
  font-size: 14px;
  position: relative;
  word-break: break-word;
}
.msg.me {
  align-self: flex-end;
  background: linear-gradient(135deg, #2563eb, #3b82f6);
}
.msg.other {
  align-self: flex-start;
  background: rgba(255,255,255,0.08);
}
.meta {
  font-size: 11px;
  opacity: 0.7;
  margin-top: 4px;
}
.composer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  display: flex;
  padding: 8px;
  background: rgba(15,23,42,0.9);
  backdrop-filter: blur(6px);
  gap: 8px;
  box-sizing: border-box;
}
.composer input {
  flex: 1;
}
.composer button {
  width: auto;
  padding: 0 16px;
}
</style>
</head>
<body>

<header>Nexora Universal Chat</header>

<div id="auth-section">
  <h3>Login or Sign Up</h3>
  <input type="email" id="email" placeholder="Email" />
  <input type="password" id="password" placeholder="Password" />
  <button id="loginBtn">Login</button>
  <button id="signupBtn">Sign Up</button>
</div>

<div id="chat-section" style="display:none; flex:1; flex-direction:column;">
  <div style="margin-bottom:10px; font-size:14px;">
    Signed in as: <span id="userEmail"></span>
    <button id="logoutBtn" style="background:#ef4444; padding:4px 8px; width:auto; float:right;">Logout</button>
  </div>
  <div class="messages" id="messages"></div>
  <div class="composer">
    <input type="text" id="msgInput" placeholder="Type a message..." />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { getDatabase, ref, push, onChildAdded, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBvgNUQsuKpqaO3trsGRXpDMGbhrM9Ngww",
  authDomain: "nexora-aa2b5.firebaseapp.com",
  databaseURL: "https://nexora-aa2b5-default-rtdb.firebaseio.com",
  projectId: "nexora-aa2b5",
  storageBucket: "nexora-aa2b5.firebasestorage.app",
  messagingSenderId: "407144990207",
  appId: "1:407144990207:web:0cdce728fba52feff7d3ca",
  measurementId: "G-WS722V82KF"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

// UI refs
const authSection = document.getElementById('auth-section');
const chatSection = document.getElementById('chat-section');
const emailEl = document.getElementById('email');
const passEl = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const signupBtn = document.getElementById('signupBtn');
const logoutBtn = document.getElementById('logoutBtn');
const userEmailEl = document.getElementById('userEmail');
const msgInput = document.getElementById('msgInput');
const sendBtn = document.getElementById('sendBtn');
const messagesEl = document.getElementById('messages');

const ROOM_PATH = 'universal_room';

// Auth events
signupBtn.onclick = () => {
  createUserWithEmailAndPassword(auth, emailEl.value, passEl.value)
    .catch(err => alert(err.message));
};
loginBtn.onclick = () => {
  signInWithEmailAndPassword(auth, emailEl.value, passEl.value)
    .catch(err => alert(err.message));
};
logoutBtn.onclick = () => {
  signOut(auth);
};

// Auth state listener
onAuthStateChanged(auth, user => {
  if (user) {
    authSection.style.display = 'none';
    chatSection.style.display = 'flex';
    userEmailEl.textContent = user.email;
    loadMessages();
  } else {
    authSection.style.display = 'block';
    chatSection.style.display = 'none';
    messagesEl.innerHTML = '';
  }
});

// Send message
sendBtn.onclick = () => {
  if (!auth.currentUser) {
    alert("You must log in first");
    return;
  }
  const text = msgInput.value.trim();
  if (!text) return;

  push(ref(db, ROOM_PATH), {
    uid: auth.currentUser.uid,
    email: auth.currentUser.email,
    text: text,
    ts: serverTimestamp()
  }).then(() => {
    msgInput.value = '';
  }).catch(err => {
    alert("Error: " + err.message);
  });
};

// Load messages
function loadMessages() {
  messagesEl.innerHTML = '';
  onChildAdded(ref(db, ROOM_PATH), snap => {
    const msg = snap.val();
    const div = document.createElement('div');
    div.className = 'msg ' + (msg.uid === auth.currentUser.uid ? 'me' : 'other');
    div.innerHTML = `<div>${msg.text}</div>
                     <div class="meta">${msg.email} — ${new Date(msg.ts || Date.now()).toLocaleTimeString()}</div>`;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  });
}
</script>

</body>
</html>